"use strict";var jwt=require("jsonwebtoken"),bcrypt=require("bcrypt"),User=require("../models/User");exports.register=function(r,t){var s,a,n,o,d,i,u,c,m,p,l;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return s=r.body,a=s.email,n=s.password,o=s.name,d=s.gender,i=s.date_of_birth,u=s.student_id,c=s.department,m=s.address,e.prev=1,e.next=4,regeneratorRuntime.awrap(bcrypt.hash(n,10));case 4:return p=e.sent,e.next=7,regeneratorRuntime.awrap(User.create({role:"peserta",email:a,password:p,name:o,gender:d,date_of_birth:i,student_id:u,department:c,address:m}));case 7:l=e.sent,t.status(201).json({message:"Registration successful",user:{id:l.user_id,email:l.email,name:l.name,gender:l.gender,date_of_birth:l.date_of_birth,student_id:l.student_id,department:l.department,address:l.address}}),e.next=15;break;case 11:e.prev=11,e.t0=e.catch(1),console.error("Error during registration:",e.t0.message),t.status(500).json({error:e.t0.message});case 15:case"end":return e.stop()}},null,null,[[1,11]])},exports.login=function(r,t){var s,a,n,o,d;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("Request Body:",r.body),s=r.body,a=s.email,n=s.password,a&&n){e.next=4;break}return e.abrupt("return",t.status(400).json({error:"Email and password are required"}));case 4:return e.prev=4,e.next=7,regeneratorRuntime.awrap(User.findOne({where:{email:a}}));case 7:if(o=e.sent){e.next=10;break}return e.abrupt("return",t.status(404).json({error:"Email tidak ditemukan"}));case 10:return e.next=12,regeneratorRuntime.awrap(bcrypt.compare(n,o.password));case 12:if(e.sent){e.next=15;break}return e.abrupt("return",t.status(401).json({error:"Password salah"}));case 15:d=jwt.sign({id:o.user_id,role:o.role},process.env.JWT_SECRET,{expiresIn:"24h"}),t.json({message:"Login successful",token:d,user:{id:o.user_id,email:o.email,name:o.name,gender:o.gender,date_of_birth:o.date_of_birth,student_id:o.student_id,department:o.department,address:o.address}}),e.next=23;break;case 19:e.prev=19,e.t0=e.catch(4),console.error("Error during login:",e.t0.message),t.status(500).json({error:e.t0.message});case 23:case"end":return e.stop()}},null,null,[[4,19]])};
//# sourceMappingURL=userController.min.js.map
